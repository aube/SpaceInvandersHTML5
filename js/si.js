"use strict";function SoundPool(t,e){var e=e||10,i=[],s=0;this.init=function(s){for(var h=0;e>h;h++){var n=new Audio(t);n.volume=.3,n.load(),i.push(n)}}(),this.play=function(){i[s].play(),s=(s+1)%e}}function Bullet(t,e,i){this.type="bullet",this.destroyOnOutOfScreen=!0,this.targets=i,this.width=Settings.bullet.width,this.height=Settings.bullet.height,this.pos={x:t,y:e},this.moveto={y:2*-this.height,x:!1},this.speed=this.getXY("speed"),this.color=Settings.bullet.color,this.draw()}function Enemy(t,e){this.destroyOnOutOfScreen=!1,this.type="enemy",this.targets="player",this.pos0={x:t,y:e},this.pos={x:t,y:e-Settings.armada.height*canvas.height-Settings.armada.marginTop*canvas.height},this.moveto={x:t,y:e},this.width=Settings.enemy.width,this.height=Settings.enemy.height,this.speed=this.getXY("speed"),this.wave=this.getXY("wave"),console.log(this.wave),this.color=Settings.enemy.color,this.sprite=Settings.enemy.sprite,this.frame=0,this.draw(),this.getPosition=function(){}}function Explosion(t,e,i,s){this.type="explosion",this.destroyOnEndAnimation=!0,this.width=i,this.height=s,this.pos={x:t,y:e},this.moveto={y:-this.height,x:!1},this.speed=this.getXY("speed"),this.sprite=Settings.explosion.sprite,this.frame=0,this.draw()}function Player(){this.type="player",this.width=Settings.player.width,this.height=Settings.player.height,this.pos={x:canvas.width/2,y:canvas.height-Settings.player.height-canvas.height*Settings.player.marginBottom},this.moveto={y:!1,x:!1},this.speed=this.getXY("speed"),this.color=Settings.player.color,this.sprite=Settings.player.sprite,this.frame=0,this.draw()}function Star(){this.type="star",this.destroyOnOutOfScreen=!0,this.moveto={x:!1,y:canvas.height+1},this.pos={x:Math.floor(Math.random()*(canvas.width-1)+1),y:0},this.width=Settings.star.width,this.height=Settings.star.height,this.speed=this.getXY("speed"),this.color=Settings.star.color,this.draw()}var Settings=Object.create(null);Settings.player={width:.1,height:.06,speed:{x:.7,y:.7},marginBottom:.01,sprite:{width:39,height:25,top:0,len:1}},Settings.bullet={width:2,height:7,speed:{x:0,y:1.6},color:"yellow",sound:"sounds/laser.mp3"},Settings.star={width:1,height:1,speed:{x:10,y:[.1,4.1]},color:"white",limit:50},Settings.armada={inrow:7,rows:3,width:.8,height:.2,marginTop:.2},Settings.enemy={horisontalMargin:.4,verticalMargin:.6,wave:{x:.4,y:1.2},speed:{x:30,y:40},sprite:{width:38,height:28,top:78,len:1}},Settings.explosion={speed:{x:0,y:0},sprite:{width:512/13,height:38,top:32,len:12},sound:"sounds/boom2.mp3"};var Entity={update:function(t){if(!this.checkOutOfScreen())return!1;if(!this.checkCollision())return!1;if(this.moveto.x!==!1&&(this.moveto.x==this.pos.x?this.moveto.x=!1:this.moveto.x<this.pos.x?this.pos.x-=Math.min(this.speed.x*t,this.pos.x-this.moveto.x):this.pos.x+=Math.min(this.speed.x*t,this.moveto.x-this.pos.x)),this.moveto.y!==!1&&(this.moveto.y==this.pos.y?this.moveto.y=!1:this.moveto.y<this.pos.y?this.pos.y-=Math.min(this.speed.y*t,this.pos.y-this.moveto.y):this.pos.y+=Math.min(this.speed.y*t,this.moveto.y-this.pos.y)),"object"==typeof this.wave&&this.waveCalculate(),"object"==typeof this.sprite&&(this.sprite.len>1&&this.frame++,this.frame>=this.sprite.len)){if(this.destroyOnEndAnimation)return!1;this.frame=0}return this.draw(),!0},waveCalculate:function(){var t=this.pos0.x-this.pos.x,e=this.pos0.y-this.pos.y;this.wave.x&&this.moveto.x===!1&&(this.moveto.x=(t>=0?1:-1)*this.wave.x+this.pos0.x),this.wave.y&&this.moveto.y===!1&&(this.moveto.y=(e>=0?1:-1)*this.wave.y+this.pos0.y)},checkCollision:function(){if("undefined"!=typeof this.targets)for(var t=Game.Objects[this.targets],e=0;e<t.length;e++)if(!(this.pos.x+this.width<=t[e].pos.x||this.pos.x>t[e].pos.x+t[e].width||this.pos.y+this.height<=t[e].pos.y||this.pos.y>t[e].pos.y+t[e].height))return t[e].onCollision(),t.splice(e,1),!1;return!0},onCollision:function(){Game.registerObject(new Explosion(this.pos.x,this.pos.y,this.width,this.height))},checkOutOfScreen:function(){return this.destroyOnOutOfScreen&&(this.pos.x>canvas.width||this.pos.x+this.width<0||this.pos.y>canvas.height||this.pos.y+this.height<0)?!1:(this.cantOutOfScreen&&(this.pos.x+this.width>canvas.width&&(this.pos.x=canvas.width-this.width),this.pos.x<0&&(this.pos.x=0),this.pos.y+this.height>canvas.height&&(this.pos.y=canvas.height-this.width),this.pos.y<0&&(this.pos.y=0)),!0)},draw:function(){ctx.save(),"object"==typeof this.sprite?ctx.drawImage(spritesImage,this.sprite.width*this.frame,this.sprite.top,this.sprite.width,this.sprite.height,this.pos.x,this.pos.y,this.width,this.height):(ctx.fillStyle=this.color,ctx.fillRect(this.pos.x,this.pos.y,this.width,this.height)),ctx.restore()},getXY:function(t){function e(t){return(""+t).indexOf(".")<0?1*t:canvas.width*t}function i(t){return(""+t).indexOf(".")<0?1*t:canvas.height*t}var s,h,n=Settings[this.type][t];return s="object"==typeof n.x?Math.floor(Math.random()*e(n.x[1])+e(n.x[0])):e(n.x),h="object"==typeof n.y?Math.floor(Math.random()*i(n.y[1])+i(n.y[0])):i(n.y),{x:s,y:h}}},SpaceInvandersHTML5=function(t){var e=Date.now(),i=Date.now(),s=Date.now(),h=(s-e)/1e3,n=document.getElementById("fps"),o=0,a=this;this.Objects=Object.create(null),this.sounds=Object.create(null),this.level=0,this.gameOver=!1,this.pause=!1,this.gameStates=function(){s-i>1e3&&(i=s,n.innerHTML=o.toFixed(0)+"fps"),0==a.Objects.enemy.length&&a.startNewLevel(),0==a.Objects.player.length&&(a.gameOver=!0,a.onGameOver())},this.startNewLevel=function(){a.level++,Settings.enemy.wave={x:.1,y:.2},Settings.enemy.speed={x:.05,y:.05},a.level%2==0&&(Settings.enemy.speed={x:[.01,.4],y:[.01,.4]}),a.level%3==0&&(Settings.enemy.speed={x:[.01,.4],y:[.01,.4]},Settings.enemy.wave={x:.3,y:.5}),a.generateEnemies();var t=document.getElementById("level");t.innerHTML="level "+a.level},this.onGameOver=function(){var t=document.getElementById("gameOver");t.style.display="block",a.Objects.player=[]},this.loop=function(){s=Date.now(),h=(s-e)/1e3,o=1e3/(s-e),e=s,a.gameStates(),a.update(h),a.pause||requestAnimationFrame(a.loop)},this.update=function(e){a.Objects.star.length<Settings.star.limit&&a.registerObject(new Star),ctx.fillRect(0,0,t.width,t.height);for(var i in a.Objects)for(var s=a.Objects[i],h=0;h<s.length;h++)s[h].update(e)||s.splice(h--,1)},this.start=function(){a.gameOver=!1,a.pause=!1,a.level=0;var t=document.getElementById("gameOver");t.style.display="none",a.Objects=Object.create(null),a.registerObject(new Star),a.registerObject(new Player),a.startNewLevel(),a.loop()},this.generateEnemies=function(t){for(var e=0;e<Settings.armada.rows;e++)for(var i=0;i<Settings.armada.inrow;i++){var s=Settings.armada.cellwidth*i+Settings.armada.pos.x+Settings.enemy.margin.x,h=Settings.armada.cellheight*e+Settings.armada.pos.y+Settings.enemy.margin.y;a.registerObject(new Enemy(s,h))}},this.registerObject=function(t){void 0==this.Objects[t.type]&&(a.Objects[t.type]=[]),a.Objects[t.type].push(t),"object"==typeof Settings[t.type].sound&&Settings[t.type].sound.play()},this.pauseToggle=function(){a.pause=!a.pause;var t=document.getElementById("pause");t.style.display=a.pause?"block":"none"},this.init=function(){Settings.player.width=Math.floor(t.width*Settings.player.width),Settings.player.height=Math.floor(t.height*Settings.player.height),Settings.armada.cellwidth=Math.floor(t.width*Settings.armada.width/Settings.armada.inrow),Settings.armada.cellheight=Math.floor(t.height*Settings.armada.height/Settings.armada.rows),Settings.armada.pos={x:t.width*(1-Settings.armada.width)/2,y:t.height*Settings.armada.marginTop},Settings.enemy.margin={x:Settings.armada.cellwidth*Settings.enemy.horisontalMargin/2,y:Settings.armada.cellheight*Settings.enemy.verticalMargin/2},Settings.enemy.width=Math.floor(Settings.armada.cellwidth-2*Settings.enemy.margin.x),Settings.enemy.height=Math.floor(Settings.armada.cellheight-2*Settings.enemy.margin.y);for(var e in Settings)Settings[e].sound&&(Settings[e].sound=new SoundPool(Settings[e].sound));document.querySelector("#gameOver > a").addEventListener("click",function(t){a.start(),t.preventDefault()}),document.addEventListener("click",function(e){if(!Game.gameOver&&e.target==t){var i=a.Objects.player[0];i.moveto.x=e.clientX-i.width/2,i.moveto.y=e.clientY-i.height/2,a.registerObject(new Bullet(i.pos.x+i.width/2,i.pos.y,"enemy"))}}),a.start()}};Bullet.prototype=Entity,Enemy.prototype=Entity,Explosion.prototype=Entity,Player.prototype=Entity,Star.prototype=Entity;
//# sourceMappingURL=si.js.map
